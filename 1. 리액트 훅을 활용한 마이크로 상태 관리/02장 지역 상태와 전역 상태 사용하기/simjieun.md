# 02. 지역 상태와 전역 상태 사용하기

> 리액트 컴포넌트는 트리 구조를 구성한다. 트리의 상위 컴포넌트에서 지역 상태를 만들고 컴포넌트와 자식 컴포넌트에서 해당 상태를 사용하기만 하면 된다. 이런 방법은 지역성과 재사용성 측면에서 좋기 때문에 보통 이런 전략을 따르는것이 권장된다. 
> 하지만 서로 멀리 떨어져 있는 둘 이상의 컴포넌트에 공통적인 상태가 필요한 경우에는 전역상태가 필요하다

# 언제 지역 상태를 사용할까?
- 자바스크립트 함수는 순수 함수와 비순수 함수로 나눌수 있다.
> 순수 함수란? 순수 함수는 오직 인수에만 의존하며 동일한 인수를 받은 경우 동일한 값을 반환한다.
> 비순수 함수란? 
- 리액트 컴포넌트에서 상태를 사용할 경우 순수하지 않게 된다. 그러나 상태가 컴포넌트 내에서만 사용된다면 다른 컴포넌트에 영향을 미치지 않는다. 이런 특성을 가리켜 **억제됨(contained)** 이라고 표현한다.

## 함수와 인수
- 자바스크립트에서 함수는 인수를 받아서 값을 반환한다.
```javascript
const addOne = (n) => n + 1;
```
- 이 함수는 같은 인수에 대해 항상 같은 값을 반환하는 순수 함수이다. 순수함수는 동작을 예측할 수 있기 때문에 선호되는 경우가 많다.

```javascript
const createContainer = () => {
    let base = 1;
    const addBase = (n) => n+base;
    const changeBase = (b) => { base = b };
    return { addBase, changeBase };
};

const { addBase, changeBase } = createContainer();
```
- base 전역 변수를 싱글턴으로 사용하는 것과 다르게 컨테이너는 격리돼 있으며 재사용하기가 더 쉽다.
- 각 컨테이너를 다른 컨테이너에 영향을 주지 않고 사용할 수 있다.
- 컨테이너의 addBase가 수학적으로 순수한 함수는 아니지만, changeBase를 통해 base를 변경하지 않는 이상 addBase를 호출하면 항상 동일한 결과를 얻을 수 있다. 
- 이 같은 특성을 **멱등성** 이라 한다.

## 리액트 컴포넌트와 props
- 리액트는 상태를 사용자 인터페이스로 변환하는 함수이다. 
- 리액트로 코드를 작성할때 리액트 컴포넌트는 말 그대로 자바스크립트 함수이며, 그것의 인수를 props라고 한다.

## 지역 상태에 대한 useState 이해하기
```javascript
const AddBase = ({ number }) => {
    const [base, changeBase] = useState(1);
    return <div>{number + base}</div>;
};
```
- useState에서 변경되지 않는 한 base를 반환하므로 AddBase 함수는 멱등성을 지닌다.
- useState가 포함된 AddBase함수는 changeBase를 함수 선언 범위 내에서만 사용할 수 있기 때문에 억제 됐다고 할 수 있다.
- useState를 이렇게 사용하는 것은 지역 상태를 사용하는 것에 해당한다.
- 컴포넌트는 억제돼 있고 컴포넌트 외부의 그 어떤 것에도 영향을 미치지 않기 때문에 지역성을 보장한다.

## 지역 상태의 한계
- 앞서 다룬 AddBase 컴포넌트를 예로 들자면, 완전히 다른 코드 영역에서 base를 변경하고 싶을때 함수 컴포넌트 외부에서 상태를 변경해야한다면 전역 상태가 필요하다.
- 상태 변수는 개념적으로 전역 변수 이다.
- 전역 변수는 함수 외부에서 자바스크립트 함수의 동작을 제어할 때 유용하게 사용할 수 있다.
- 전역 상태는 컴포넌트 외부에서 리액트 컴포넌트의 동작을 제어할 때 유용하게 사용할 수 있지만 컴포넌트 동작을 예측하기 어렵다는 장단점이 있다.

## 지역 상태를 효과적으로 사용하는 방법

### 상태 끌어올리기
- 두 컴포넌트의 상태를 공유하고 하나의 공유된 카운터로 작동하게 만들고 싶다면 부모 컴포넌트를 만들고 상태를 상위 컴포넌트로 전달하면 된다.

### 내용 끌어올리기
- 상위 컴포넌트의 상태에 의존하지 않는 컴포넌트라면 JSX요소를 상위 컴포넌트로 끌어올린다.

# 전역 상태 사용하기

## 전역 상태란?
- 상태가 하나의 컴포넌트에 속하지 않고 여러 컴포넌트에서 사용할 수 있다면 전역상태이다.
- 전역 상태에 대해 

## 언제 전역 상태를 사용할까?
### prop을 전달하는 것이 적절하지 않을 때
- 컴포넌트 트리에서 서로 멀리 떨어져 있는 두 컴포넌트 간에 상태를 공유해야 할 경우 공통 루트 컴포넌트에 상태를 만드는것보다는 전역 상태를 사용하는게 낫다.
- 여러단계로 구성된 컴포넌트를 통해 props를 전달하는 것은 불필요한 작업이기 때문이다. 중간 컴포넌트가 리렌더링 되면 성능에 영항을 미칠 가능성이 높다.

### 이미 리액트 외부에 상태가 있을 때

- 외부에 전역 상태를 두는 편이 더 간단하기 때문에 이미 리액트 외부에 전역 상태를 가지고 있을 것이다.
- 애플리케이션에서 리액트 없이 획득한 사용자 인증 정보가 있을 수 있다. 이같은 경우에는 전역 상태가 리액트 외부에 존재해야 하며, 

전역상태는 주로 지역 상태 대신 사용되며, 전역 상태를 사용하기 좋은 두가지 패턴이 있다.
하나는 prop 전달이 적절하지 않은 경우고 
다른하나는 전역 상태가 이미 애플리케이션에 존재하는 경우다.
