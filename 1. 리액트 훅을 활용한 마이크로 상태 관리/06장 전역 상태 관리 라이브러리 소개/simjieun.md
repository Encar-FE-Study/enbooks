# 06장. 전역 상태 관리 라이브러리 소개
- 라이브러리를 알아보기에 앞서 전역 상태의 특성을 이해하기 위해 전역 상태와 관련된 문제와 함께 전역 상태 라이브러리에서 상태가 위치하는 곳과 리렌더링을 제어하는 방법이라는 두가지 측면에 대해서 알아보자

## 전역 상태 관리 문제 해결하기
- 전역 상태 사용을 피하는 것이 좋지만 전역 상태를 사용하는 것은 매우 편리하며 생산성을 높일 수 있다.
- 그러나 전역 상태를 설계할 때는 두가지 문제점이 있다.
#### 1. 첫번째 문제점은 전역 상태를 읽는 방법이다
- 전역 상태를 사용하는 컴포넌트에서 전역 상태의 모든 값이 필요하지 않은 경우엔 전역 상태가 바뀌면 리렌더링이 발생한다.
- 변경된 값이 컴포넌트와 관련 없는 경우에도 리렌더링이 발생한다.
#### 2. 두번쩨 문제점은 전역 상태에 값을 넣거나 갱신하는 방법이다.
- 전역 상태에 중첩된 객체일 경우에 하나의 프로퍼티를 수정하기 위해 직접 수정할 경우에

## 데이터 중심 접근 방식과 컴포넌트 중심 접근 방식 사용하기

### 데이터 중심 접근 방식 이해하기
- 데이터 중심 접근 방식에서는 먼저 애플리케이션의 데이터 모델을 정의하고 이를 관리하는 구조로 설계한다.
- 컴포넌트는 데이터가 미리 준비되어 있는 상태에서 데이터에 접근하여 필요한 정보를 표시하거나 변경할 수 있다.
- 이 경우 데이터는 컴포넌트의 생명 주기와 관게없이 유지된다.
- 데이터 중심 접근 방식을 사용하는 전역 상태 라이브러리
  - Zustand : 모듈 상태로 데이터를 관리하며, 리액트 외부 메모리에서 상태를 유지한다.
  - Redux : 컴포넌트와 무관하게 데이터가 중앙에서 관리되고, 애플리케이션 전체에서 일관된 상태를 유지하는데 적합하다
  - MobX : 상태를 독립적으로 저장하고 필요할 때만 리액트 컴포넌트에 연결한다.

### 컴포넌트 중심 접근 방식 이해하기
- 컴포넌트 중심 접근 방식에서는 컴포넌트 구조와 생명주기를 기준으로 상태를 관리한다.
- 주로 특정 컴포넌트 트리가 마운트되었을 때만 필요한 상태에 적합하다.
- 상태가 컴포넌트 생명주기와 동일하게 유지되며, 컴포넌트가 마운트 해제되면 상태도 사라지도록 설계한다.
- 컴포넌트 중심 접근 방식을 사용하는 전역 상태 라이브러리
  - React Context : 특정 컴포넌트 트리 내에서 전역 상태를 관리하며, 컴포넌트 생명 주기와 함께 상태가 생기고 사라지게 설계할 수 있다.
  - Jotai : 컴포넌트별로 상태를 관리할 수 있으며, 필요할 때만 상태를 메모리에 유지한다.
  - Recoil : 컴포넌트에 의존하는 상태를 트리 내에서 관리할때 유용하다.

## 두 접근 방식의 예외
- 꼭 데이터 중심 접근 방식과 컴포넌트 중심 접근 방식 중 하나만 선택해야 하는 것은 아니다.
- 실제로 두가지 접근방식 중 하나를 사용하거나 두가지 접근방식을 함께 사용할 수 있다.

## 리렌더링 최적화
- 전역 상태 라이브러리를 설계할 때 고려해야 할 핵심 문제이다.
- 리렌더링 최적화의 핵심은 컴포넌트에서 state의 어느 부분이 사용될지 지정하는 것이다.
- state의 일부분을 지정하는 3가지 접근방식이 있다.
  - 선택자 함수 사용
  - 속성 접근 감지
  - 아톰 사용

### 선택자 함수 사용
- 선택자 함수는 상태를 받아 상태의 일부만 반환한다.
- 선택자 함수는 컴포넌트의 어느 부분을 사용할지 명시적으로 지정하는 방법이므로 이를 수동 최적화라고 한다.

### 속성 접근 감지
- 속성 접근을 감지하고 감지한 정보를 렌더링 최적화에 사용할 수 있는 상태 사용 추적이라는것이 있다.
- 상태 사용 추적 기능이 있는 useTrackedState 훅이 있다고 가정해보면, trackedState가 .b.c속성에 접근했음을 감지할 수있고, .b.c속성값이 변경될때만 useTrackedState가 리렌더링을 발생시킨다.
- 따라서 useSelector는 수동 렌더링 최적화인 반면 useTrackedState는 자동 렌더링 최적화이다.
- useTrackedState를 구현하려면 상태 객체에 대한 속성 접근을 확인하기 위한 프락시가 필요하다.

### 아톰 사용
- 아톰은 리렌더링을 발생시키는 데 사용되는 최소 상태 단위이다.
- 아톰을 사용하면 좀 더 세분화해서 구독하는 것이 가능하다.
- 아톰을 사용하는 접근 방식은 수동 최적화와 자동 최적화의 중간 정도로 볼 수 있다.
- 아톰과 파생 값의 정의는 명시적이지만 의존성 추적은 자동으로 된다.
- 
